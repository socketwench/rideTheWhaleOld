<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

  <title>Ride the Whale! Docker for Drupalists</title>

  <link rel="stylesheet" href="css/reveal.css">
  <link rel="stylesheet" href="css/theme/moby.css">

  <!-- Theme used for syntax highlighting of code -->
  <link rel="stylesheet" href="lib/css/zenburn.css">

  <!-- Printing and PDF exports -->
  <script>
    var link = document.createElement('link');
    link.rel = 'stylesheet';
    link.type = 'text/css';
    link.href = window.location.search.match(/print-pdf/gi) ? 'css/print/pdf.css' : 'css/print/paper.css';
    document.getElementsByTagName('head')[0].appendChild(link);
  </script>
</head>
<body>
<div class="reveal">
  <div class="slides">
    <section>
      <h1>Ride the Whale!</h1>
      <h2>Docker for Drupalists</h2>
      <img src="images/controls.png" />
    </section>

    <section>
      <section data-background-transition="none"
               data-background="images/socketwench/socketwench1.png"
               data-background-size="contain">
        <aside class="notes">
          So you might be wondering who is this weird person in front
          of you. And yes, I do make that
          face when I get to go on a business trip.
        </aside>
      </section>
      <section data-background-transition="none"
               data-background="images/socketwench/socketwench2.png"
               data-background-size="contain">
        <aside class="notes">
          My name is Tess Flynn, otherwise known as socketwench.
        </aside>
      </section>
      <section data-background-transition="none"
               data-background="images/socketwench/socketwench3.png"
               data-background-size="contain">
        <aside class="notes">
          That's wench, not wrench.
        </aside>
      </section>
      <section data-background-transition="none"
               data-background="images/socketwench/socketwench4.png"
               data-background-size="contain">
        <aside class="notes">
          I'm the module maintainer for Flag, Flag Friend, and
          Examples.
        </aside>
      </section>
      <section data-background-transition="none"
               data-background="images/socketwench/socketwench5.png"
               data-background-size="contain">
        <aside class="notes">
          And I work as a Drupal Developer for FFW, the largest Drupal
          consultancy in the world.
        </aside>
      </section>
    </section>

    <section>
      <section>
        <h1>"I just want to code!"</h1>
        <h2>"Not argue with MAMP."</h2>
      </section>
      <section>
        <h2>Problem #1</h2>
        <p>No Sandboxing.</p>
      </section>
      <section>
        <h2>Problem #2</h2>
        <p>NOM NOM NOM Disk Space</p>
      </section>
      <section>
        <h2>Problem #3</h2>
        <p>"Build tool? You mean this Word doc?"</p>
      </section>
      <section>
        <h2>Instructions aren't enough</h2>
        <p>Because humans are fallible.</p>
      </section>
    </section>

    <!--
    @todo Reduce or eliminate this section.
    This section isn't really necessary because it can be more easily explained
    in context later in the talk. Then we can see how Docker solves are pain
    points with more practicality.
    -->
    <section>
      <section>
        <h1>Why Docker?</h1>
      </section>
      <section>
        <h2>Sandboxing by design</h2>
      </section>
      <section>
        <h2>Painless De-duplication</h2>
      </section>
      <section>
        <h2>Baked-in Build Automation</h2>
        <p>No need to install anything else.</p>
      </section>
    </section>

    <section>
      <section>
        <h1>Getting Docker</h1>
      </section>
      <section>
        <h2>Wait, I need a VM?</h2>
      </section>
      <section>
        <h2>Docker Machine</h2>
      </section>
      <section>
        <h2>Docker Toolbox</h2>
        <p>Easiest way to install on Mac and Windows</p>
        <p>https://www.docker.com/products/docker-toolbox</p>
      </section>
      <section>
        <h2>Docker On Linux</h2>
        <p>Docker's native environment</p>
        <p>No need for a VM</p>
      </section>
      <section>
        <h2>Installing on Linux</h2>
        <p>Use your distro's package manager</p>
      </section>
    </section>

    <section>
      <section>
        <h1>Your First Container</h1>
      </section>
      <section>
        <h2>No, you don't need to install Linux</h2>
      </section>
      <section>
        <h2>Pull command</h2>
        <code>docker pull the_container_name</code>
        <p class="fragment">Think: <code>git pull</code></p>
      </section>
      <section>
        <h2>Docker Hub</h2>
        <p>Online registry of pre-made containers</p>
        <p>https://hub.docker.com/</p>
      </section>
      <section>
        <h2>Anyone can upload to Hub!</h2>
        <p>Container "source files" uploaded.</p>
        <p>Hub "compiles" the container for use.</p>
      </section>
      <section>
        <h2>Official Debian Container</h2>
        <pre><code>
$ docker pull debian
        </code></pre>
        <p>Good starter for web projects.</p>
      </section>
      <section>
        <h2>Running a Container</h2>
        <code>docker run</code>
      </section>
      <section>
        <pre><code>
$ docker run -i -t debian /bin/bash
        </code></pre>
      </section>
      <!--
      @todo Graphic breaking down each part of the run command.
      -->
      <section>
        <h2>Listing containers</h2>
        <pre><code>
$ docker ps
CONTAINER ID       IMAGE        COMMAND            CREATED             STATUS
        </code></pre>
      </section>
      <section>
        <h2>Waitaminute, "ps"?</h2>
        <p>Like the UNIX "ps" command?</p>
      </section>
      <section>
        <h2>"A container is just a process."</h2>
        <p class="fragment">Not exactly true, but close.</p>
      </section>
      <!--
      @todo Graphic explaining Docker as an intersection of technologies
      -->
      <section>
        <h2>Listing all containers</h2>
        <pre><code>
$ docker ps -a
CONTAINER ID       IMAGE        COMMAND            CREATED             STATUS
0c6142a4488a       debian       "/bin/bash"        8 seconds ago       Exited
        </code></pre>
      </section>
    </section>

    <section>
      <section>
        <h1>Make a server in just one text file</h1>
      </section>
      <section>
        <h2>Dockerfiles</h2>
        <p>Basis of Docker's build system</p>
      </section>
      <section>
        <h2>Structure</h2>
        <code>DIRECTIVE parameter</code>
        <p class="fragment">https://docs.docker.com/</p>
      </section>
      <section>
        <h2>The first two directives</h2>
        <pre><code>FROM debian:wheezy
MAINTAINER your_email@example.com</code></pre>
      </section>
      <section>
        <h2>Turtles all the way down</h2>
        <p>All containers are build on top of another container</p>
      </section>
      <!--
      @todo Stack graphic showing container image inheritance.
      -->
      <section>
        <h2>"scratch" container</h2>
        <p>Parent of all Docker containers.</p>
        <p class="fragment">Just an empty *.tar.gz file</p>
      </section>
      <section>
        <h2>FROM directive</h2>
        <code>FROM name:version</code>
        <p>Version is optional, defaults to "latest"</p>
      </section>
      <section>
        <h2>Using your Dockerfile</h2>
        <p><code>docker build /path/to/Dockerfile</code></p>
      </section>
      <section>
        <pre><code>$ docker build .
Sending build context to Docker daemon 2.048 kB
Sending build context to Docker daemon
Step 0 : FROM debian:wheezy
 ---> 60c52dbe9d91
Step 1 : MAINTAINER your_email@example.com
 ---> Running in 486f3a2255b4
 ---> 64b0d7e8eef9
Removing intermediate container 486f3a2255b4
Successfully built 64b0d7e8eef9</code></pre>
      </section>
      <section>
        <h2>Is it running?</h2>
        <pre class="fragment"><code>$ docker ps -q
$</code></pre>
        <p><code>-q</code> switch = list only container IDs.</p>
      </section>
      <section>
        <h2>Nothing! What the heck!?</h2>
        <p>It built "successfully" but nothing is running.</p>
        <p>"Removing intermediate container" is a hint.</p>
      </section>
    </section>

    <section>
      <section>
        <h1>Images</h1>
      </section>
      <section>
        <h2>VMs are like Pudding</h2>
        <p>It's one big blob of stuff.</p>
      </section>
      <section>
        <h2>Containers are like Cake</h2>
        <p>They have layers!</p>
      </section>
      <section>
        <h2>It's not just where you're FROM</h2>
        <p>Each line in the Dockerfile is like a commit.</p>
      </section>
      <!--
      @todo Graphic correlating lines in the Dockerfile to different overlaid images
      -->
      <section>
        <p>Listing images</p>
        <pre><code>$ docker images
REPOSITORY   TAG        IMAGE ID       CREATED           VIRTUAL SIZE
                        64b0d7e8eef9   1 minutes ago     85.02 MB
debian       wheezy     60c52dbe9d91   4 weeks ago       85.02 MB
debian       latest     9a61b6b1315e   4 weeks ago       125.2 MB</code></pre>
      </section>
      <section>
        <h2>Intermediate containers?</h2>
      </section>
      <section>
        <h2>Containers vs Images</h2>
      </section>
      <section>
        <h2>Base image</h2>
        <p>It's just an image</p>
        <p>Usually whatever image you start with</p>
      </section>
      <section>
        <h2>Running a container</h2>
        <code>docker run c0nt41n3rHa5h /path/to/command</code>
      </section>
      <section>
        <pre><code>$ docker run -i -t 64b /bin/bash</code></pre>
      </section>
      <section>
        <pre><code>root@71724ddf264b:/# cat /etc/issue
Debian GNU/Linux 7 \n \l</code></pre>
      </section>
    </section>

    <section>
      <section>
        <h1>Installing Software</h1>
      </section>
      <section>
        <h2>No INSTALL directive</h2>
        <p>It lets the container decide!</p>
      </section>
      <!--
      @TODO THIS. IS. LINUX!!!!!!11?1!
      -->
      <section>
        <h2>Base image decides the tool</h2>
        <p>Debian and Ubuntu use <code>apt-get</code></p>
        <p>Red Hat uses <code>yum</code></p>
        <p>Arch uses <code>pacman</code></p>
      </section>
      <section>
        <h2>RUN directive</h2>
        <code>RUN some_command -with arguments</code>
        <p>Runs the specified command in the container</p>
      </section>
      <section>
        <pre><code>FROM debian:wheezy
MAINTAINER your_email@example.com

RUN apt-get update
RUN apt-get install -y apache2</code></pre>
      </section>
      <section>
        <pre><code>$ docker build .
Sending build context to Docker daemon 2.048 kB
Sending build context to Docker daemon
Step 0 : FROM debian:wheezy
 ---> 60c52dbe9d91
Step 1 : MAINTAINER your_email@example.com
 ---> Using cache
 ---> 64b0d7e8eef9
Step 2 : RUN apt-get update
 ---> Running in 8652b461d629
Get:1 http://security.debian.org wheezy/updates Release.gpg [1554 B]
...
Fetched 8438 kB in 7s (1094 kB/s)
Reading package lists...
 ---> eefa2fcb15e7
Removing intermediate container 8652b461d629
Step 3 : RUN apt-get install -y apache2
 ---> Running in ef474ef3a976
Reading package lists...
Building dependency tree...
Reading state information...
…
Setting up libswitch-perl (2.16-2) ...
 ---> aa084388ac30
Removing intermediate container ef474ef3a976
Successfully built aa084388ac30</code></pre>
      </section>
      <section>
        <pre><code>$docker images
REPOSITORY   TAG        IMAGE ID       CREATED           VIRTUAL SIZE
                        aa084388ac30   2 minutes ago     145 MB
debian       wheezy     60c52dbe9d91   4 weeks ago       85.02 MB
debian       latest     9a61b6b1315e   4 weeks ago       125.2 MB</code></pre>
      </section>
      <section>
        <h2>Where'd our image go!?</h2>
        <p>docker build replaced our old image</p>
      </section>
      <section>
        <h2>Union FS</h2>
      </section>
    </section>

    <section>
      <section>
        <h1>Background Containers</h1>
      </section>
      <section>
        <pre><code>$ docker run -i -t aa0 /bin/bash</code></pre>
      </section>
      <section>
        <pre><code>
$ apachectl start
        </code></pre>
      </section>
      <section>
        <pre><code>$ docker run -i -t aa0 apachectl start
apache2: Could not reliably determine the server's fully qualified domain name, using 172.17.0.7 for ServerName</code></pre>
      </section>
      <section>
        <pre><code>$ docker ps -a
CONTAINER ID    IMAGE      COMMAND              CREATED             STATUS
9d0eab0934fe    aa0        "apachectl start"    2 minutes ago       Exited (0) 2 minutes ago</code></pre>
      </section>
      <section>
        <pre><code>$ docker run -i -t aa0 apachectl -D FOREGROUND</code></pre>
      </section>
      <section>
        <pre><code>$ docker ps
CONTAINER ID     IMAGE    COMMAND                CREATED             STATUS
059950c67e5b     aa0      "apachectl -D FOREGR   About a minute ago   Up About a minute</code></pre>
      </section>
      <section>
        <h2>Stopping a Background Container</h2>
        <pre><code>$ docker kill 864
864</code></pre>
      </section>
    </section>

    <section>
      <section>
        <h1>Entrypoints</h1>
      </section>
      <section>
        <h2>Default Command</h2>
        <pre><code>CMD [“apachectl”, “-D”, “FOREGROUND”]</code></pre>
      </section>
      <section>
        <h2>Specifying an entrypoint</h2>
        <pre><code>CMD [“-D”, “FOREGROUND”]
ENTRYPOINT [“apachectl”]</code></pre>
      </section>
      <section>
        <h2>When we ran the cotainer...</h2>
        <pre><code>$ docker run -i -t aa0 apachectl -D FOREGROUND</code></pre>
        <p>...did this in the container:</p>
        <pre><code>$ /bin/sh -c “apachectl -D FOREGROUND”</code></pre>
      </section>
      <section>
        <h2>Our Dockerfile so far</h2>
        <pre><code>FROM debian:wheezy
MAINTAINER your_email@example.com

RUN apt-get update
RUN apt-get install -y apache2

CMD ["-D", "FOREGROUND"]
ENTRYPOINT ["apachectl"]</code></pre>
      </section>
      <section>
        <h2>Updating an existing container</h2>
        <code>
docker build <strong>&lt;your_container_id&gt;</strong>
        </code>
      </section>
      <section>
        <pre><code>$ docker build .

Sending build context to Docker daemon 2.048 kB
Sending build context to Docker daemon
Step 0 : FROM debian:wheezy
 ---> 60c52dbe9d91
Step 1 : MAINTAINER your_email@example.com
 ---> Using cache
 ---> 64b0d7e8eef9
Step 2 : RUN apt-get update
 ---> Using cache
 ---> eefa2fcb15e7
Step 3 : RUN apt-get install -y apache2
 ---> Using cache
 ---> aa084388ac30
Step 4 : CMD -D FOREGROUND
 ---> Running in 32b9f66cf1e3
 ---> 239ae06b7d68
Removing intermediate container 32b9f66cf1e3
Step 5 : ENTRYPOINT apachectl
 ---> Running in 6ac785739695
 ---> 72b3cac68438
Removing intermediate container 6ac785739695
Successfully built 72b3cac68438</code></pre>
      </section>
      <section>
        <pre><code>$ docker run -d 72b
988bf0c8cdfdf88c42e3673a65597f78693c07b14070cd535962b13b36884560

$ docker ps
CONTAINER ID        IMAGE         COMMAND                CREATED             STATUS
988bf0c8cdfd        72b           "apachectl -D FOREGR   4 seconds ago       Up 3 seconds</code></pre>
      </section>
    </section>

    <section>
      <section>
        <h1>There's no place like 127.0.0.1</h1>
      </section>
      <section>
        <pre><code>$ boot2docker ip
192.168.59.103</code></pre>
      </section>
      <section>
        <h2>/etc/hosts</h2>
        <pre><code>192.168.59.103	docker.dev</code></pre>
      </section>
      <section>
        <h2>Exposing Ports</h2>
        <pre><code>EXPOSE 80</code></pre>
      </section>
    </section>

    <section>
      <section>
        <h1>Docker Compose</h1>
      </section>
      <section>
        <pre><code>web:
   build: .</code></pre>
      </section>
      <section>
        <h2>Overriding Dockerfiles</h2>
        <pre><code>web:
   build: .
   ports:
      - “80:80”</code></pre>
      </section>
      <section>
        <h2>"Up"ing a container</h2>
        <pre><code>$ docker-compose up -d</code></pre>
      </section>
      <section>
        <pre><code>$ docker-compose kill
$ docker-compose rm</code></pre>
      </section>
      <section>
        <pre><code>$ docker ps
CONTAINER ID   COMMAND                STATUS       NAMES
245fbb0bf255   "apachectl -D FOREGR   Up 18 secs   dockerthingy_web_1

$ pwd
/home/tess/dockerthingy</code></pre>
      </section>
    </section>

    <section>
      <section>
        <h1>Containing your files</h1>
      </section>
      <section>
        <pre><code>COPY path/on/host.txt /target/path/on/container.txt</code></pre>
      </section>
      <section>
        <pre><code>FROM debian:wheezy
MAINTAINER your_email@example.com

RUN apt-get update
RUN apt-get install -y apache2

COPY index.html /var/www

CMD ["-D", "FOREGROUND"]
ENTRYPOINT ["apachectl"]</code></pre>
      </section>
      <section>
        <h2>Updating container sets</h2>
        <code>docker-compose build</code>
        <p>From your container set's directory</p>
      </section>
      <section>
        <pre><code>$ docker-compose up -d

$ curl docker.dev
&lt;html&gt;
&lt;body&gt;
&lt;h1&gt;Behold, my amazing page!&lt;/h1&gt;
&lt;p>Okay, yeah, it sucks. Sorry.&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
      </section>
      <section>
        <h2>Volumes</h2>
        <pre><code>web:
   build: .
   ports:
      - “80:80”
   volumes:
      - docroot:/var/www</code></pre>
      </section>
      <section>
        <h2>Directory Structure</h2>
        <pre><code>&lt;your_project_root&gt;
├── docker-compose.yml
├── Dockerfile
└── docroot/
    └── index.html</code></pre>
      </section>
    </section>

    <section>
      <section>
        <h1>Moar Conatainz!</h1>
      </section>
      <section>
        <h2>Docker Hub</h2>
      </section>
      <section>
        <h2>Remote images</h2>
        <p><code>image</code> directive</p>
      </section>
      <section>
        <pre><code>web:
   build: .docker/web
   ports:
      - "80:80"
   volumes:
      - docroot:/var/www
db:
   image: mysql
   ports:
      - 3306:3306</code></pre>
      </section>
      <section>
        <pre><code>&lt;your_project_root&gt;
├── .docker
│   ├── db
│   └── web
│       └── Dockerfile
├── docker-compose.yml
└── docroot
    └── index.html
        </code></pre>
      </section>
    </section>

    <section>
      <section>
        <h1>Configuration</h1>
      </section>
      <section>
        <h2>Environment Directive</h2>
        <pre><code>web:
   build: .docker/web
   ports:
      - "80:80"
   volumes:
      - docroot:/var/www
db:
   image: mysql
   ports:
      - 3306:3306
   environment:
      - MYSQL_DB=drupal8
      - MYSQL_USER=drupal
      - MYSQL_PASS=thisisawesome</code></pre>
      </section>
    </section>

  </div>
</div>

<script src="lib/js/head.min.js"></script>
<script src="js/reveal.js"></script>

<script>
  // More info https://github.com/hakimel/reveal.js#configuration
  Reveal.initialize({
    controls: false,
    progress: true,
    history: true,
    center: true,
    width: 1024,
    height: 763,
    transition: 'slide', // none/fade/slide/convex/concave/zoom

    // More info https://github.com/hakimel/reveal.js#dependencies
    dependencies: [
      {src: 'plugin/markdown/marked.js'},
      {src: 'plugin/markdown/markdown.js'},
      {src: 'plugin/notes/notes.js', async: true},
      {
        src: 'plugin/highlight/highlight.js',
        async: true,
        callback: function () {
          hljs.initHighlightingOnLoad();
        }
      }
    ]
  });
</script>
</body>
</html>
